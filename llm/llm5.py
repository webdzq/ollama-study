import ollama
def ollama_image_caption(msg):
    client = ollama.Client(host='http://localhost:11434')
    # 设置提示语
    prompt_v = msg or "hello world"
    response = client.generate(
        model='llava', prompt=prompt_v)
    return response

# 调用
# 指令内容，使用 ``` 来分隔指令和待总结的内容
text = f"""
在一个迷人的村庄里，兄妹杰克和吉尔出发去一个山顶井里打水。\
他们一边唱着欢乐的歌，一边往上爬，\
然而不幸降临——杰克绊了一块石头，从山上滚了下来，吉尔紧随其后。\
虽然略有些摔伤，但他们还是回到了温馨的家中。\
尽管出了这样的意外，他们的冒险精神依然没有减弱，继续充满愉悦地探索。
"""
# example 1
prompt = f"""
1-用一句话概括下面用<>括起来的文本。
2-将摘要翻译成英语。
3-在英语摘要中列出每个名称。
4-输出一个 JSON 对象，其中包含以下键：English_summary，num_names。

请使用以下格式：
文本：<要总结的文本>
摘要：<摘要>
翻译：<摘要的翻译>
名称：<英语摘要中的名称列表>
输出 JSON：<带有 English_summary 和 num_names 的 JSON>

Text: <{text}>
"""

caption = ollama_image_caption(prompt)

print(caption)

'''
{
    'model': 'llava',
    'created_at': '2024-10-30T12:39:37.4474Z',
    'response': ' 文本：<在一个迷人的村庄里，兄妹杰克和吉尔出发去一个山顶井里打水。他们一边唱着欢乐的歌，一边往上爬，然而不幸降临——杰克绊了一块石头，从山上滚了下来，吉尔紧随其后.虽然略有些摔伤,但他们还是回到了温馨的家中.尽管出了这样的意外,他们的冒险精神依然没有减弱,继续充满愉悦地探索。>\n
            摘要：The siblings Jack and Jill set out on an adventure to fetch water from a mountain spring. As they sang happily along the way, they tripped over a rock and both fell downhill. Although they were slightly injured, they still made it back home. Despite the unfortunate incident, their adventurous spirit did not diminish, and they continued to explore with joy.\n
            翻译：The siblings Jack and Jill went on an adventure to fetch water from a mountain spring. As they sang happily along the way, they tripped over a rock and both fell downhill. Although they were slightly injured, they still made it back home. Despite the unfortunate incident, their adventurous spirit did not diminish, and they continued to explore with joy.\n名称：Jack, Jill\n输出 JSON：{“English_summary”: “The siblings Jack and Jill went on an adventure to fetch water from a mountain spring. As they sang happily along the way, they tripped over a rock and both fell downhill. Although they were slightly injured, they still made it back home. Despite the unfortunate incident, their adventurous spirit did not diminish, and they continued to explore with joy.”, “num_names”: 2} ',
    'done': True,
    'done_reason': 'stop',
    'context': [733, 16289, 28793, 28705, 13, 28740, 28733, 28963, 28969, 30347, 29456, 31137, 30574, 29061, 29181,
        28963, 28675, 30574, 29676, 29263, 28914, 29019, 29119, 28944, 13, 28750, 28733, 29248, 233, 148, 155,
        29059, 31051, 30883, 29025, 30193, 29892, 28944, 13, 28770, 28733, 29010, 30193, 29892, 233, 148, 155,
        29059, 28991, 29150, 29065, 29513, 28995, 29046, 29377, 28944, 13, 28781, 28733, 29226, 29065, 28518, 9292,
        28705, 29051, 29254, 28924, 29450, 28991, 29333, 29872, 29074, 29061, 29728, 28994, 27871, 28730, 3499,
        28924, 2575, 28730, 5889, 28944, 13, 13, 29067, 29154, 28963, 29074, 29061, 29293, 29122, 28994, 13, 29019,
        29119, 28994, 28789, 29059, 29758, 29218, 28914, 29019, 29119, 28767, 13, 233, 148, 155, 29059, 28994,
        28789, 233, 148, 155, 29059, 28767, 13, 31051, 30883, 28994, 28789, 233, 148, 155, 29059, 28914, 31051,
        30883, 28767, 13, 29046, 29377, 28994, 28789, 30193, 29892, 233, 148, 155, 29059, 28991, 28914, 29046,
        29377, 29150, 29024, 28767, 13, 29226, 29065, 9292, 28994, 28789, 30197, 28998, 4300, 28730, 3499, 28705,
        29131, 2075, 28730, 5889, 28705, 28914, 9292, 28767, 13, 13, 1874, 28747, 523, 13, 29010, 28518, 235, 194,
        186, 29086, 28914, 30071, 31372, 29400, 28924, 31944, 232, 169, 188, 233, 160, 179, 30329, 29131, 30784,
        30333, 29065, 29099, 29651, 28518, 29480, 30118, 30729, 29400, 29576, 29692, 28944, 29440, 29550, 28969,
        29860, 232, 151, 180, 30163, 30920, 30488, 28914, 30509, 28924, 28969, 29860, 30717, 29054, 234, 139, 175,
        28924, 29713, 29746, 28988, 31339, 30852, 30793, 12789, 233, 160, 179, 30329, 234, 190, 141, 29105, 28969,
        29739, 29942, 29640, 28924, 29505, 29480, 29054, 30787, 29105, 29061, 29263, 28924, 30784, 30333, 234, 183,
        170, 30179, 29450, 29120, 28944, 235, 156, 192, 29713, 30223, 28998, 29904, 233, 148, 151, 31546, 28924,
        29926, 29440, 29550, 29751, 28971, 29034, 29036, 29105, 30971, 236, 169, 171, 28914, 29490, 28991, 28944,
        31430, 29497, 29065, 29105, 29176, 29675, 28914, 29462, 29638, 28924, 29440, 29550, 28914, 232, 137, 149,
        31413, 30170, 29836, 30505, 29713, 29444, 28998, 30608, 232, 191, 180, 28924, 30471, 30199, 30282, 30493,
        233, 135, 140, 233, 133, 169, 29146, 31498, 29630, 28944, 13, 28767, 13, 733, 28748, 16289, 28793, 28705,
        29019, 29119, 28994, 28789, 29010, 28518, 235, 194, 186, 29086, 28914, 30071, 31372, 29400, 28924, 31944,
        232, 169, 188, 233, 160, 179, 30329, 29131, 30784, 30333, 29065, 29099, 29651, 28518, 29480, 30118, 30729,
        29400, 29576, 29692, 28944, 29440, 29550, 28969, 29860, 232, 151, 180, 30163, 30920, 30488, 28914, 30509,
        28924, 28969, 29860, 30717, 29054, 234, 139, 175, 28924, 29713, 29746, 28988, 31339, 30852, 30793, 12789,
        233, 160, 179, 30329, 234, 190, 141, 29105, 28969, 29739, 29942, 29640, 28924, 29505, 29480, 29054, 30787,
        29105, 29061, 29263, 28924, 30784, 30333, 234, 183, 170, 30179, 29450, 29120, 28723, 235, 156, 192, 29713,
        30223, 28998, 29904, 233, 148, 151, 31546, 28725, 29926, 29440, 29550, 29751, 28971, 29034, 29036, 29105,
        30971, 236, 169, 171, 28914, 29490, 28991, 28723, 31430, 29497, 29065, 29105, 29176, 29675, 28914, 29462,
        29638, 28725, 29440, 29550, 28914, 232, 137, 149, 31413, 30170, 29836, 30505, 29713, 29444, 28998, 30608,
        232, 191, 180, 28725, 30471, 30199, 30282, 30493, 233, 135, 140, 233, 133, 169, 29146, 31498, 29630, 28944,
        28767, 13, 233, 148, 155, 29059, 28994, 1014, 27139, 4299, 304, 475, 425, 808, 575, 356, 396, 15982, 298,
        11702, 2130, 477, 264, 10660, 7474, 28723, 1136, 590, 15166, 24693, 2267, 272, 1069, 28725, 590, 2629, 3641,
        754, 264, 4463, 304, 1560, 5970, 1060, 19156, 28723, 5800, 590, 654, 7191, 15714, 28725, 590, 1309, 1269,
        378, 852, 1611, 28723, 10191, 272, 27245, 10824, 28725, 652, 9987, 324, 607, 5838, 863, 459, 17724, 789,
        28725, 304, 590, 5317, 298, 11418, 395, 10186, 28723, 13, 31051, 30883, 28994, 1014, 27139, 4299, 304, 475,
        425, 2068, 356, 396, 15982, 298, 11702, 2130, 477, 264, 10660, 7474, 28723, 1136, 590, 15166, 24693, 2267,
        272, 1069, 28725, 590, 2629, 3641, 754, 264, 4463, 304, 1560, 5970, 1060, 19156, 28723, 5800, 590, 654,
        7191, 15714, 28725, 590, 1309, 1269, 378, 852, 1611, 28723, 10191, 272, 27245, 10824, 28725, 652, 9987, 324,
        607, 5838, 863, 459, 17724, 789, 28725, 304, 590, 5317, 298, 11418, 395, 10186, 28723, 13, 29046, 29377,
        28994, 26803, 28725, 475, 425, 13, 29226, 29065, 9292, 28994, 28751, 28835, 27871, 28730, 3499, 28838,
        28747, 981, 1014, 27139, 4299, 304, 475, 425, 2068, 356, 396, 15982, 298, 11702, 2130, 477, 264, 10660,
        7474, 28723, 1136, 590, 15166, 24693, 2267, 272, 1069, 28725, 590, 2629, 3641, 754, 264, 4463, 304, 1560,
        5970, 1060, 19156, 28723, 5800, 590, 654, 7191, 15714, 28725, 590, 1309, 1269, 378, 852, 1611, 28723, 10191,
        272, 27245, 10824, 28725, 652, 9987, 324, 607, 5838, 863, 459, 17724, 789, 28725, 304, 590, 5317, 298,
        11418, 395, 10186, 2435, 28725, 981, 2575, 28730, 5889, 28838, 28747, 28705, 28750, 28752, 28705],
    'total_duration': 190440714667,
    'load_duration': 11697379386,
    'prompt_eval_count': 343,
    'prompt_eval_duration': 47711788000,
    'eval_count': 433,
    'eval_duration': 130999992000
}

'''