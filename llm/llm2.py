import ollama
def ollama_image_caption(msg):
    client = ollama.Client(host='http://localhost:11434')
    # 设置提示语
    prompt_v = msg or "hello world"
    response = client.generate(
        model='llava', prompt=prompt_v)
    return response

# 调用
# 指令内容，使用 ``` 来分隔指令和待总结的内容
prompt = f"""
请生成包括书名、作者和类别的三本虚构的、非真实存在的中文书籍清单，\
并以 JSON 格式提供，其中包含以下键:book_id、title、author、genre。
"""

caption = ollama_image_caption(prompt)

print(caption)

'''

{'model': 'llava', 
'created_at': '2024-10-30T08:21:06.472657Z',
'response': ' ```json\n[\n  {\n    "book_id": "001",\n    "title": "虚构的奇妙旅程",\n    "author": "虚构作者",\n    "genre": "科幻"\n  },\n  {\n    "book_id": "002",\n    "title": "虚构的悲喜离合",\n    "author": "虚构作者",\n    "genre": "爱情小说"\n  },\n  {\n    "book_id": "003",\n    "title": "虚构的神秘故事",\n    "author": "虚构作者",\n    "genre": "悬疑小说"\n  }\n]\n``` ',
'done': True, 'done_reason': 'stop', 
'context': [733, 16289, 28793, 28705, 13, 29067, 29128, 29025, 29333, 30574, 30117, 29046, 29041, 29089, 29276, 29131, 29066, 29705, 28914, 29492, 29119, 31415, 29612, 28914, 29041, 29764, 29974, 29247, 29079, 29010, 28914, 28991, 29019, 30117, 234, 180, 144, 29649, 29113, 28924, 29457, 29074, 9292, 28705, 29293, 29122, 29279, 29954, 28924, 29450, 28991, 29333, 29872, 29074, 29061, 29728, 28747, 3521, 28730, 313, 29041, 3901, 29041, 6239, 29041, 2383, 267, 28944, 13, 733, 28748, 16289, 28793, 8789, 3371, 13, 28792, 13, 28705, 371, 13, 2287, 345, 3521, 28730, 313, 1264, 345, 28734, 28734, 28740, 548, 13, 2287, 345, 3901, 1264, 345, 31415, 29612, 28914, 30786, 232, 169, 156, 31414, 29265, 548, 13, 2287, 345, 6239, 1264, 345, 31415, 29612, 29089, 29276, 548, 13, 2287, 345, 2383, 267, 1264, 345, 30226, 232, 188, 190, 28739, 13, 28705, 1630, 13, 28705, 371, 13, 2287, 345, 3521, 28730, 313, 1264, 345, 28734, 28734, 28750, 548, 13, 2287, 345, 3901, 1264, 345, 31415, 29612, 28914, 233, 133, 181, 30754, 30254, 29234, 548, 13, 2287, 345, 6239, 1264, 345, 31415, 29612, 29089, 29276, 548, 13, 2287, 345, 2383, 267, 1264, 345, 30731, 29418, 29138, 29616, 28739, 13, 28705, 1630, 13, 28705, 371, 13, 2287, 345, 3521, 28730, 313, 1264, 345, 28734, 28734, 28770, 548, 13, 2287, 345, 3901, 1264, 345, 31415, 29612, 28914, 29836, 31544, 31063, 29339, 548, 13, 2287, 345, 6239, 1264, 345, 31415, 29612, 29089, 29276, 548, 13, 2287, 345, 2383, 267, 1264, 345, 233, 133, 175, 234, 153, 148, 29138, 29616, 28739, 13, 28705, 443, 13, 28793, 13, 13940, 28832, 28705], 
'total_duration': 64303550932, 'load_duration': 8836919283, 'prompt_eval_count': 74, 'prompt_eval_duration': 8279269000, 'eval_count': 184, 'eval_duration': 47173761000}
 
'''