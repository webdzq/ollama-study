import ollama
def ollama_image_caption(msg):
    client = ollama.Client(host='http://localhost:11434')
    # 设置提示语
    prompt_v = msg or "hello world"
    response = client.generate(
        model='llava', prompt=prompt_v)
    return response

# 调用
# 指令内容，使用 ``` 来分隔指令和待总结的内容
# 示例：产品说明书
prod_review = """
这个熊猫公仔是我给女儿的生日礼物，她很喜欢，去哪都带着。
公仔很软，超级可爱，面部表情也很和善。但是相比于价钱来说，
它有点小，我感觉在别的地方用同样的价钱能买到更大的。
快递比预期提前了一天到货，所以在送给女儿之前，我自己玩了会。
"""
# Prompt ：基于说明书创建营销描述
prompt = f"""
您的任务是从电子商务网站上生成一个产品评论的简短摘要。

请对三个反引号之间的评论文本进行概括，最多30个字。

评论: ```{prod_review}```
"""
caption = ollama_image_caption(prompt)

print(caption)

'''
{
    'model': 'llava',
    'created_at': '2024-11-01T03:24:04.775189Z',
    'response': ' 这个熊猫公仔是女孩喜欢的礼物，非常可爱和软弯，价格较高但快递速度好，送到一天前。 ',
    'done': True,
    'done_reason': 'stop',
    'context': [733, 16289, 28793, 28705, 13, 29689, 28914, 29454, 29224, 28971, 29505, 29742, 29169, 29397, 29224,
        29533, 29992, 29054, 29128, 29025, 28518, 29818, 29346, 30252, 30144, 28914, 30470, 30132, 233, 148, 155,
        29059, 28944, 13, 13, 29067, 29051, 29492, 28995, 30004, 29544, 29170, 29332, 29117, 28914, 30252, 30144,
        29019, 29119, 29258, 29037, 31137, 30574, 28924, 29190, 29292, 28770, 28734, 28995, 29031, 28944, 13, 13,
        30252, 30144, 28747, 8789, 13, 29176, 28995, 234, 137, 141, 31664, 29443, 231, 190, 151, 28971, 29242,
        29709, 29933, 30915, 28914, 29128, 29142, 31195, 29535, 28924, 30715, 30111, 30754, 30920, 28924, 29651,
        30951, 29460, 30197, 30163, 28944, 13, 29443, 231, 190, 151, 30111, 30769, 28924, 29800, 29486, 29052,
        30731, 28924, 29181, 29237, 29024, 29418, 29537, 30111, 29131, 31580, 28944, 29926, 28971, 29367, 29605,
        29160, 29970, 30582, 29263, 29616, 28924, 13, 29928, 28998, 29085, 29138, 28924, 29242, 30266, 31345, 29010,
        29705, 28914, 29146, 29082, 28963, 29338, 29675, 28914, 29970, 30582, 29084, 30704, 29036, 29250, 29050,
        28914, 28944, 13, 30059, 30380, 29605, 30098, 29275, 29279, 29087, 29105, 28969, 29354, 29036, 30227, 28924,
        29163, 29074, 29010, 29434, 29709, 29933, 30915, 29332, 29087, 28924, 29242, 29159, 29957, 30656, 29105,
        29179, 28944, 13, 13940, 28832, 13, 733, 28748, 16289, 28793, 28705, 29176, 28995, 234, 137, 141, 31664,
        29443, 231, 190, 151, 28971, 29933, 31437, 30754, 30920, 28914, 31195, 29535, 28924, 29764, 29408, 29052,
        30731, 29131, 30769, 232, 191, 178, 28924, 29970, 29293, 30459, 29366, 29926, 30059, 30380, 30029, 29184,
        29530, 28924, 29434, 29036, 28969, 29354, 29087, 28944, 28705],
    'total_duration': 57824013820,
    'load_duration': 10199289815,
    'prompt_eval_count': 199,
    'prompt_eval_duration': 31997167000,
    'eval_count': 49,
    'eval_duration': 15617059000
}

'''