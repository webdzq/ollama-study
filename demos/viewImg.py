
# 实现看图写话功能

'''
# pip install ollama
# ollama run llava
 LLava 是一种新型的端到端训练大型多模态模型，它结合了视觉编码器和 Vicuna，用于通用视觉和语言理解。更新至 1.6 版本
 from: https://ollama.com/library/llava
'''
import ollama
import base64

# 看图写话
def image_to_base64(image_path):
    with open(image_path, "rb") as image_file:
        encoded_string = base64.b64encode(image_file.read()).decode('utf-8')
    return encoded_string


def ollama_image_caption(image_path):
    client = ollama.Client(host='http://localhost:11434')
    # 将图片转换为 base64 编码
    base64_image = image_to_base64(image_path)
    # 设置提示语，引导模型对图片进行描述
    prompt = "要求使用简体中文,根据图写一篇200字的中文作文："
    response = client.generate(
        model='llava', prompt=prompt, images=[base64_image])
    return response


# 调用
image_path = "/Users/apple/github/ollama-study/demos/assets/1.png"  # 替换为你的图片路径
caption = ollama_image_caption(image_path)
print(caption)


'''

[Running] python -u "/Users/apple/github/ollama-study/demos/viewImg.py"
输出结果：
model='llava' 
created_at='2025-02-12T02:23:31.683324Z'
done=True done_reason='stop' 
total_duration=91568378131 
load_duration=34907898
prompt_eval_count=615 
prompt_eval_duration=2726000000 
eval_count=463 
eval_duration=88791000000 
response=' 在美丽的青春之谷，一个小镇沿着一条清流的溪水。这个地方具有悠长的山脉和繁华的树林，以及一些小家和巡航船只为游客而设计的旅游村庄。\n\n这里碑装的小镇拥有自然美景，包括山中的溪水、蔓蔚花园和茂密的树林。而且，溪流上游的船子带给了生机勃勃的气息，让人想要去亲近这些自然奇美景象。 \n\n旅游村庄则是一座小镇，沿着溪水和树林的边缘建立。它们主要为游客提供住宿、餐饮和娱乐服务，让人们在此地度过一个快乐愉悦的旅行生活。\n\n而且，这里的天空也是一个重要元素。清洁的天空表现出美丽的景色，带给了整个景色的愉悦感觉。 \n\n此外，小镇附近还有一些小溪和蔓蔚花园，给人们不同的风格和娱乐活动。在这里，游客可以在溪流上游、睡在水面的房间或漫步在树林中。\n\n总的来说，这个地方是一个美丽的旅游目的地，具有自然美景和一切为游客而设计的服务。它让人们不仅可以欣赏到悠长的山脉、清流溪水和繁华的树林，还能在小镇附近享受到各种旅游活动和娱乐服务。 '
context=[733, 16289, 28793, 733, 5422, 28733, 28734, 28793, 13, 13, 29059, 29243, 29154, 28963, 30470, 29337, 28991, 29019, 28725, 29521, 29020, 29183, 29503, 28969, 234, 178, 138, 28750, 28734, 28734, 29031, 28914, 28991, 29019, 29089, 29019, 28994, 733, 28748, 16289, 28793, 28705, 29010, 29817, 31625, 28914, 30377, 30643, 29332, 30894, 28924, 28518, 29138, 29780, 233, 181, 194, 30163, 28969, 29391, 29649, 29642, 28914, 31490, 29692, 28944, 29176, 28995, 29146, 29082, 29737, 28998, 233, 133, 163, 29495, 28914, 29480, 235, 135, 140, 29131, 31839, 30430, 28914, 30157, 30158, 28924, 29074, 29965, 28969, 29904, 29138, 29490, 29131, 232, 186, 164, 30795, 31828, 29405, 29003, 30239, 29763, 29746, 29081, 29382, 28914, 31414, 30239, 30071, 31372, 28944, 13, 13, 29176, 29400, 234, 165, 148, 29722, 28914, 29138, 29780, 31855, 28998, 29159, 29713, 29817, 29960, 28924, 29333, 30574, 29480, 28991, 28914, 31490, 29692, 29041, 235, 151, 150, 235, 151, 157, 30064, 31180, 29131, 235, 143, 133, 29385, 28914, 30157, 30158, 28944, 29746, 29958, 28924, 31490, 29642, 29054, 30239, 28914, 31828, 29169, 30197, 29709, 29105, 29128, 29363, 232, 142, 134, 232, 142, 134, 28914, 30627, 29069, 28924, 30447, 29086, 30023, 29059, 29651, 31395, 30363, 29176, 29904, 29159, 29713, 30786, 29817, 29960, 29254, 28944, 28705, 13, 13, 31414, 30239, 30071, 31372, 29310, 28971, 28969, 30635, 29138, 29780, 28924, 233, 181, 194, 30163, 31490, 29692, 29131, 30157, 30158, 28914, 29860, 234, 191, 155, 29193, 29831, 28944, 29928, 29550, 29345, 29059, 29003, 30239, 29763, 29279, 29954, 30705, 31553, 29041, 31243, 236, 168, 177, 29131, 232, 171, 180, 30488, 29430, 29224, 28924, 30447, 29086, 29550, 29010, 29320, 29146, 29184, 29202, 28518, 30059, 30488, 233, 135, 140, 233, 133, 169, 28914, 31414, 29037, 29128, 29785, 28944, 13, 13, 29746, 29958, 28924, 29176, 29400, 28914, 29354, 29273, 29537, 28971, 28518, 29249, 29059, 29352, 29555, 28944, 29649, 233, 183, 132, 28914, 29354, 29273, 29024, 29419, 29065, 29817, 31625, 28914, 29960, 29395, 28924, 30197, 29709, 29105, 29681, 28995, 29960, 29395, 28914, 233, 135, 140, 233, 133, 169, 30266, 31345, 28944, 28705, 13, 13, 29320, 29638, 28924, 29138, 29780, 30560, 30363, 29751, 28998, 28969, 29904, 29138, 31490, 29131, 235, 151, 150, 235, 151, 157, 30064, 31180, 28924, 29709, 29086, 29550, 28988, 29338, 28914, 30206, 29293, 29131, 232, 171, 180, 30488, 29785, 29129, 28944, 29010, 29176, 29400, 28924, 30239, 29763, 29052, 29074, 29010, 31490, 29642, 29054, 30239, 29041, 234, 160, 164, 29010, 29692, 29181, 28914, 30376, 29117, 29355, 233, 191, 174, 29783, 29010, 30157, 30158, 28991, 28944, 13, 13, 29758, 28914, 29263, 29616, 28924, 29176, 28995, 29146, 29082, 28971, 28518, 29817, 31625, 28914, 31414, 30239, 29222, 28914, 29146, 28924, 29737, 28998, 29159, 29713, 29817, 29960, 29131, 28969, 29961, 29003, 30239, 29763, 29746, 29081, 29382, 28914, 29430, 29224, 28944, 29928, 30447, 29086, 29550, 28988, 30472, 29052, 29074, 233, 175, 166, 235, 184, 146, 29036, 233, 133, 163, 29495, 28914, 29480, 235, 135, 140, 29041, 29649, 29642, 31490, 29692, 29131, 31839, 30430, 28914, 30157, 30158, 28924, 29751, 29084, 29010, 29138, 29780, 30560, 30363, 30461, 30154, 29036, 30344, 29824, 31414, 30239, 29785, 29129, 29131, 232, 171, 180, 30488, 29430, 29224, 28944, 28705]
'''